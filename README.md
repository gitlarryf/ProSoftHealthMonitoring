# ProSoft Health Monitoring
## Why?
In Industrial Automation it is not enough to just read data from your Modbus sensors, or your DNP3 Outstations, or your DF1 Slaves.  If one of them fails, there is no way to alert operators that the data they're viewing is wrong.  Imagine a scenario where you're filling a tank that takes over a minute to register any significant change in level.  But alas!  The tank level sensor was knocked out of commission when Loopy Groundz worked on the panel yesterday, and hosed up the wiring, not to mention the company sent out Langston Packetfltor from IT to update some switch settings, that ended up blocking port 502 on _all_ ports, not just the one port he was supposed to configure.  So, what happens in the PLC is that we have the last values that we read from those sensor devices in our ProSoft gateway and our inRAx module.  So, the morning operators open the valves to start filling the tank, and they go away to get their morning caffeine injections.  The code in the PLC is doing what it was programmed to do, and it does not close any valves, or raise any alarms, because the tank levels remain low.  So, by the time the operators are back, there is serious trouble brewing around the plant.
## Using These Routines
Using these routines can prevent a Chernobyl by allowing you to alert your operators when you notice that devices are offline.  (Note: the MVI69E-MBS and MVI69E-MBTCP are the only ProSoft modules that support value overrides on error!)  Other modules will maintain the last known value that we read successfully from the device.  With these routines here you can design alarms, or even design your SCADA system to draw red boxes around the values, or grey out the cute images of your plant when we're not successfully reading data from those sensors.  These routines can be designed to return a single BOOL tag that signals if we're in error or not; or you can customize them to check for specific error values and provide detailed error explanations on screen--if you're so inclined.  In the samples, you'll see that I have a garden variety 1794-OB8, that I have wired to a Stack Light in our support lab.  The color of the light tower tells me at a glance if life is good or not.  How you use these routines is entirely up to you.
## But why Structured Text??
I hear you.  You're a ladder guy.  Most of you are.  In short, I prefer Structured Text because of the loops that need to be executed, and the fact that ASCII is much easier to manage than XML in the form of an L5X file.  Because they are not L5X files, you must do a little work of your own to make use of this code.  Can they be done in Ladder?  Absolutely.  Will I do them in Ladder?  Absolutely not.  That being said, if you'd still like to use these in your own productions, first, you need to add a new routine of Structured Text type, then paste the contents of one of these routines into it.  Next, you need to create a `JSR` ladder opcode to call this new routine from your existing ladder, often right before, or right after any ProSoft AOI calls.  Each routine contains a [Flower Box](https://en.wiktionary.org/wiki/flower_box) at the top of the code.  Listed in the flower box is all of the tags that the routine utilizes.  You will need to create said tags before these routines will ever compile.  For the PLX30 gateways, and MVI56(E)-MNET, MNETR, MNETC, MNETCR modules, you will need to configure the Command Error Pointer to place the command errors into the `MNET*.DATA.ReadData` array, as well as populating the correct tags to tell the code where to look for these error values.  The MVI56(E)-MCM, MVI56E-DNPNET, and MVI56-DFCM are the only modules where all of this can be computed in the PLC on the fly.
## Support
There is none.  I cannot, and will not support these routines.  I am open to pull requests if you want to help improve these routines, or if you spot a bug.  For legal reasons, this code is provided here only for reference--for novelty purposes only.  Before you implement these into your own plant, I urge you to flog the wee of out of these routines, and make sure they do what you want, and expect them to do.  If they do not, then please fix them until they are acceptable for use in **_your_** plant.
